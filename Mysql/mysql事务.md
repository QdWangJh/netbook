### 介绍

mysql中只有InnoDB引擎支持事务(Transation)

- 可以用来维护数据库的完整性,保证成批的sql要么全执行,要么全不执行
- 事务用来管理 DDL,DML,DCL操作,默认自动提交

### 特性

- 原子性
    - 事务是一个不可分割的整体,事务开始后的所有操作,要么全部完成,要么全部不做

- 一致性
    - 系统从一个正确的状态,迁移到另一个正确的状态
- 隔离性
    - 每个事务的对象对于其他事务的操作对象相互分离,事务提交前对其他事务不可见
- 持久性
    - 事务一但提交,其结果是永久性的

### 操作

#### 开启事务

```sql
BEGIN 或 START TRANSACTION
```

#### 提交事务

```sql
COMMIT;
```

#### 回滚事务

```sql
ROLLBACK;
```

### mysql自动提交事务

```sql
set autocommit = 0 禁止自动提交
set autocommit = 1 开启自动提交
```

### 查看开启状态

```sql
select @@autocommit;
```

### 注意

- 使用手动提交事务时(多条语句要同时成功)需要先关闭自动提交
- 提交事务和回滚事务需要单独运行
- 判断执行成功与否,可以使用select查询结果,在未提交事务时,数据库中的数据是不会发生改变,但是用select可以查询到最新状态,在提交或回滚后,数据才会发生改变



### 事务的隔离级别

- READ UNCOMMITTED  读未提交

    一个事务可以读取另一个未提交事务的数据,最低级别,任何情况都无法保证,会造成脏读

A事务读取到B事务没有提交的数据.

- READ COMMITTED 读可提交(orcal 默认)

一个事务要等另一个事务提交后才能读取数据,可避免脏读的发生,会造成不可重复读

A事务在没有提交之前,看到的数据不一致

- REPEATEABLE READ 可重复读(mysql默认)

在开始读取数据(事务开启)时,不再允许修改操作,可避免脏读,不可重复读的发生,但是会造成幻读

A事务在提交之前和提交之后看到的数据不一致

- SERIALIZABLE 序列化(串行)

最高的事务隔离级别,事务串行化顺序执行,可避免脏读,不可重复读与幻读.

但是这种事务隔离级别效率低下,比较耗费数据库性能

A事务操作表时,表会被锁起,B事务不能操作.



### 事务的隔离级别-操作

```mysql
-- 查看隔离级别
show variables like '%isolation%';

-- 设置隔离级别

set session transaction isolation level      read uncommitted;

```

